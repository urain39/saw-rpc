!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";var i=void 0,o={}.hasOwnProperty,r=(u.prototype.onOpen=function(t){return this._ws.addEventListener("open",t),this._listeners.open.push(t),this},u.prototype.onError=function(t){return this._ws.addEventListener("error",t),this._listeners.error.push(t),this},u.prototype.onClose=function(t){return this._ws.addEventListener("close",t),this._listeners.close.push(t),this},u.prototype.onNotify=function(t,e){return this._notifiers[t]=e,this},u.prototype.request=function(t,e,r,n){return void 0===n&&(n=!1),this._request(t,e,r,n),this},u.prototype._request=function(t,e,r,n,s){var o;!n&&this.requestCount>=u.MAX_REQUEST_COUNT&&!s?r(i,{code:u.ERROR_MAX_CONCURRENT,message:"Max concurrent error"}):(s===i&&(s=this._requestId++,n||this.requestCount++),this.isReady?(o={jsonrpc:"2.0",id:s,method:t,params:e},this._ws.send(JSON.stringify(o)),this._handlers[s]=r):this._requests.push([t,e,r,n,s]))},u.prototype.close=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(t=this._ws).close.apply(t,e)},u.prototype.reconnect=function(){for(var t=this._listeners,e=new WebSocket(this.rpcPath),r=0,n=t.open;r<n.length;r++){var s=n[r];e.addEventListener("open",s)}for(var o=0,i=t.error;o<i.length;o++){s=i[o];e.addEventListener("error",s)}for(var u=0,c=t.message;u<c.length;u++){s=c[u];e.addEventListener("message",s)}for(var a=0,h=t.close;a<h.length;a++){s=h[a];e.addEventListener("close",s)}return this._ws=e,this},u.MAX_REQUEST_COUNT=8,u.ERROR_MAX_CONCURRENT=-32032,u);function u(t,e){this.rpcPath=t,this.preprocess=e,this.isReady=!1,this.requestCount=0,this._ws=new WebSocket(this.rpcPath),this._requestId=0,this._requests=[],this._listeners={open:[],error:[],message:[],close:[]},this._handlers={},this._notifiers={};var s=this;this.onOpen(function(){s.isReady=!0;for(var t=s._requests;0<t.length;)s._request.apply(s,t.shift())}),this.onClose(function(){s.isReady=!1}),this._ws.addEventListener("message",e=function(t){var e=JSON.parse(t.data),t=s.preprocess;if(t&&(e=t(e)),o.call(e,"id")){var r=e.id,n=s._handlers;if(o.call(n,r)){t=n[r];if(o.call(e,"result"))t(e.result,i);else{if(!o.call(e,"error"))throw new Error("Invalid response with no `result` or `error`");t(i,e.error)}delete n[r],s.requestCount--}}else{if(!o.call(e,"method"))throw new Error("Invalid response with no `id` or `method`");n=e.method,r=s._notifiers;o.call(r,n)&&(n=r[n],(e=e.params)&&n(e))}}),this._listeners.message.push(e)}var c=void 0,a=/[/\\]/;function n(t){for(var e=[],r=0,n=t.split(a);r<n.length;r++){var s=n[r];0<s.length&&e.push(s)}return(a.test(t.charAt(0))?"/":"")+e.join("/")}function s(t){var e,r,n;for(n in t)"string"==(r=typeof(e=t[n]))?t[n]=function(t){var e=t.length;if(0<e&&e<=20){e=Number(t);if(e||0===e)return e;if("true"===t)return!0;if("false"===t)return!1;if("null"===t)return null}return t}(e):"object"==r&&s(e);return t}var h=(t.getTitleName=function(t,e){t=n(t.path),e=n(e);return t.slice(e.length+1).split(a)[0]},t.prototype.connect=function(t,e){this.rpcPath=t,this._secret="token:"+e,this._jsonrpc=new r(t,s)},t.prototype.onNotify=function(t,e){this._jsonrpc.onNotify(t,function(t){t!==c&&e(t[0])})},t.prototype.request=function(t,e,s){void 0===s&&(s=!0);var o=this._jsonrpc;return new Promise(function(r,n){o.request("aria2."+t,e,function(t,e){e?n(e):r(t)},s)})},t.prototype.addUri=function(t,e,r){t=[this._secret,t];return e!==c&&(t.push(e),r!==c&&t.push(r)),this.request("addUri",t)},t.prototype.addTorrent=function(t,e,r,n){t=[this._secret,t];return e!==c&&(t.push(e),r!==c&&(t.push(r),n!==c&&t.push(n))),this.request("addTorrent",t)},t.prototype.addMetalink=function(t,e,r){t=[this._secret,t];return e!==c&&(t.push(e),r!==c&&t.push(r)),this.request("addMetalink",t)},t.prototype.remove=function(t){t=[this._secret,t];return this.request("remove",t)},t.prototype.forceRemove=function(t){t=[this._secret,t];return this.request("forceRemove",t)},t.prototype.pause=function(t){t=[this._secret,t];return this.request("pause",t)},t.prototype.pauseAll=function(){var t=[this._secret];return this.request("pauseAll",t)},t.prototype.forcePause=function(t){t=[this._secret,t];return this.request("forcePause",t)},t.prototype.forcePauseAll=function(){var t=[this._secret];return this.request("forcePauseAll",t)},t.prototype.unpause=function(t){t=[this._secret,t];return this.request("unpause",t)},t.prototype.unpauseAll=function(){var t=[this._secret];return this.request("unpauseAll",t)},t.prototype.tellStatus=function(t,e,r){void 0===r&&(r=!1);t=[this._secret,t];return e!==c&&t.push(e),this.request("tellStatus",t,r)},t.prototype.getUris=function(t){t=[this._secret,t];return this.request("getUris",t)},t.prototype.getFiles=function(t){t=[this._secret,t];return this.request("getFiles",t)},t.prototype.getPeers=function(t){t=[this._secret,t];return this.request("getPeers",t)},t.prototype.getServers=function(t){t=[this._secret,t];return this.request("getServers",t)},t.prototype.tellActive=function(t,e){void 0===e&&(e=!1);var r=[this._secret];return t!==c&&r.push(t),this.request("tellActive",r,e)},t.prototype.tellWaiting=function(t,e,r,n){void 0===n&&(n=!1);e=[this._secret,t,e];return r!==c&&e.push(r),this.request("tellWaiting",e,n)},t.prototype.tellStopped=function(t,e,r,n){void 0===n&&(n=!1);e=[this._secret,t,e];return r!==c&&e.push(r),this.request("tellStopped",e,n)},t.prototype.changePosition=function(t,e,r){r=[this._secret,t,e,r];return this.request("changePosition",r)},t.prototype.changeUri=function(t,e,r,n,s){n=[this._secret,t,e,r,n];return s!==c&&n.push(s),this.request("changeUri",n)},t.prototype.getOption=function(t){t=[this._secret,t];return this.request("getOption",t)},t.prototype.changeOption=function(t,e){e=[this._secret,t,e];return this.request("changeOption",e)},t.prototype.getGlobalOption=function(){var t=[this._secret];return this.request("getGlobalOption",t)},t.prototype.changeGlobalOption=function(t){t=[this._secret,t];return this.request("changeGlobalOption",t)},t.prototype.getGlobalStat=function(){var t=[this._secret];return this.request("getGlobalStat",t)},t.prototype.purgeDownloadResult=function(){var t=[this._secret];return this.request("purgeDownloadResult",t)},t.prototype.removeDownloadResult=function(t){t=[this._secret,t];return this.request("purgeDownloadResult",t)},t.prototype.getVersion=function(){var t=[this._secret];return this.request("getVersion",t)},t.prototype.getSessionInfo=function(){var t=[this._secret];return this.request("getSessionInfo",t)},t.prototype.saveSession=function(){var t=[this._secret];return this.request("saveSession",t)},t);function t(){}var l=function(t,i,u,c){return new(u=u||Promise)(function(r,e){function n(t){try{o(c.next(t))}catch(t){e(t)}}function s(t){try{o(c.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?r(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(n,s)}o((c=c.apply(t,i||[])).next())})},p=function(r,n){var s,o,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,o&&(i=2&e[0]?o.return:e[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,e[1])).done)return i;switch(o=0,(e=i?[2&e[0],i.value]:e)[0]){case 0:case 1:i=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(i=0<(i=u.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){u.label=e[1];break}if(6===e[0]&&u.label<i[1]){u.label=i[1],i=e;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(e);break}i[2]&&u.ops.pop(),u.trys.pop();continue}e=n.call(r,u)}catch(t){e=[6,t],o=0}finally{s=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},f=new h;f.connect("ws://localhost:6800/jsonrpc","arcticfox"),function(){l(this,void 0,void 0,function(){var e,r;return p(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,f.changeOption("0000000000000000",{"max-download-limit":"2M","max-upload-limit":"2M"})];case 1:return e=t.sent(),[3,3];case 2:return r=t.sent(),console.log("Error: ",r),[3,3];case 3:return f.onNotify("downloadStart",function(t){console.log("startDownload('"+t.gid+"');")}),f.onNotify("btDownloadComplete",function(r){return l(this,void 0,void 0,function(){var e;return p(this,function(t){switch(t.label){case 0:return console.log("btDownloadComplete('"+r.gid+"');"),[4,f.tellStatus(r.gid,["dir","files"])];case 1:return e=t.sent(),console.log("files: "+JSON.stringify(e.files)),e.files&&e.dir&&console.log("TitleName: "+h.getTitleName(e.files[0],e.dir)),[2]}})})}),console.log(e),[2]}})})}()});
