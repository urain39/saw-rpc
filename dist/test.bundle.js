!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";var o=void 0,i={}.hasOwnProperty,r=(u.prototype.onOpen=function(t){return this._ws.addEventListener("open",t),this._listeners.open.push(t),this},u.prototype.onError=function(t){return this._ws.addEventListener("error",t),this._listeners.error.push(t),this},u.prototype.onClose=function(t){return this._ws.addEventListener("close",t),this._listeners.close.push(t),this},u.prototype.onNotify=function(t,e){return this._notifiers[t]=e,this},u.prototype.request=function(t,e,r,n){return void 0===n&&(n=!1),this._request(t,e,r,n),this},u.prototype._request=function(t,e,r,n,s){if(s===o&&(s=this._requestId++,!n)){if(this.requestCount>=u.MAX_REQUEST_COUNT)return void r(o,{code:u.ERROR_MAX_CONCURRENT,message:"Max concurrent error"});this.requestCount++}var i;this.isReady?(i={jsonrpc:"2.0",id:s,method:t,params:e},this._ws.send(JSON.stringify(i)),this._handlers[s]=r):this._requests.push([t,e,r,n,s])},u.prototype.close=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(t=this._ws).close.apply(t,e)},u.prototype.reconnect=function(){for(var t=this._listeners,e=new WebSocket(this.rpcPath),r=0,n=t.open;r<n.length;r++){var s=n[r];e.addEventListener("open",s)}for(var i=0,o=t.error;i<o.length;i++){s=o[i];e.addEventListener("error",s)}for(var u=0,a=t.message;u<a.length;u++){s=a[u];e.addEventListener("message",s)}for(var c=0,h=t.close;c<h.length;c++){s=h[c];e.addEventListener("close",s)}return this._ws=e,this},u.MAX_REQUEST_COUNT=8,u.ERROR_MAX_CONCURRENT=-32032,u);function u(t,e){this.rpcPath=t,this.preprocess=e,this.isReady=!1,this.requestCount=0,this._ws=new WebSocket(this.rpcPath),this._requestId=0,this._requests=[],this._listeners={open:[],error:[],message:[],close:[]},this._handlers={},this._notifiers={};var s=this;this.onOpen(function(){s.isReady=!0;for(var t=s._requests;0<t.length;)s._request.apply(s,t.shift())}),this.onClose(function(){s.isReady=!1}),this._ws.addEventListener("message",e=function(t){var e=JSON.parse(t.data),t=s.preprocess;if(t&&(e=t(e)),i.call(e,"id")){var r=e.id,n=s._handlers;if(i.call(n,r)){t=n[r];if(i.call(e,"result"))t(e.result,o);else{if(!i.call(e,"error"))throw new Error("Invalid response with no `result` or `error`");t(o,e.error)}delete n[r],s.requestCount--}}else{if(!i.call(e,"method"))throw new Error("Invalid response with no `id` or `method`");n=e.method,r=s._notifiers;i.call(r,n)&&(n=r[n],(e=e.params)&&n(e))}}),this._listeners.message.push(e)}var a=void 0,c=/[/\\]/;function n(t){for(var e=[],r=0,n=t.split(c);r<n.length;r++){var s=n[r];0<s.length&&e.push(s)}return(c.test(t.charAt(0))?"/":"")+e.join("/")}var s=(t.getTitleName=function(t,e){t=n(t.path),e=n(e);return t.slice(e.length+1).split(c)[0]},t.prototype.onNotify=function(t,e){this._jsonrpc.onNotify(t,function(t){t!==a&&e(t[0])})},t.prototype.request=function(t,e,s){void 0===s&&(s=!0);var i=this._jsonrpc;return new Promise(function(r,n){i.request(t,e,function(t,e){e?n(e):r(t)},s)})},t.prototype.addUri=function(t,e,r){t=[this._secret,t];return e!==a&&(t.push(e),r!==a&&t.push(r)),this.request("aria2.addUri",t)},t.prototype.addTorrent=function(t,e,r,n){t=[this._secret,t];return e!==a&&(t.push(e),r!==a&&(t.push(r),n!==a&&t.push(n))),this.request("aria2.addTorrent",t)},t.prototype.addMetalink=function(t,e,r){t=[this._secret,t];return e!==a&&(t.push(e),r!==a&&t.push(r)),this.request("aria2.addMetalink",t)},t.prototype.remove=function(t){t=[this._secret,t];return this.request("aria2.remove",t)},t.prototype.forceRemove=function(t){t=[this._secret,t];return this.request("aria2.forceRemove",t)},t.prototype.pause=function(t){t=[this._secret,t];return this.request("aria2.pause",t)},t.prototype.pauseAll=function(){var t=[this._secret];return this.request("aria2.pauseAll",t)},t.prototype.forcePause=function(t){t=[this._secret,t];return this.request("aria2.forcePause",t)},t.prototype.forcePauseAll=function(){var t=[this._secret];return this.request("aria2.forcePauseAll",t)},t.prototype.unpause=function(t){t=[this._secret,t];return this.request("aria2.unpause",t)},t.prototype.unpauseAll=function(){var t=[this._secret];return this.request("aria2.unpauseAll",t)},t.prototype.tellStatus=function(t,e,r){void 0===r&&(r=!1);t=[this._secret,t];return e!==a&&t.push(e),this.request("aria2.tellStatus",t,r)},t.prototype.getUris=function(t){t=[this._secret,t];return this.request("aria2.getUris",t)},t.prototype.getFiles=function(t){t=[this._secret,t];return this.request("aria2.getFiles",t)},t.prototype.getPeers=function(t){t=[this._secret,t];return this.request("aria2.getPeers",t)},t.prototype.getServers=function(t){t=[this._secret,t];return this.request("aria2.getServers",t)},t.prototype.tellActive=function(t,e){void 0===e&&(e=!1);var r=[this._secret];return t!==a&&r.push(t),this.request("aria2.tellActive",r,e)},t.prototype.tellWaiting=function(t,e,r,n){void 0===n&&(n=!1);e=[this._secret,t,e];return r!==a&&e.push(r),this.request("aria2.tellWaiting",e,n)},t.prototype.tellStopped=function(t,e,r,n){void 0===n&&(n=!1);e=[this._secret,t,e];return r!==a&&e.push(r),this.request("aria2.tellStopped",e,n)},t.prototype.changePosition=function(t,e,r){r=[this._secret,t,e,r];return this.request("aria2.changePosition",r)},t.prototype.changeUri=function(t,e,r,n,s){n=[this._secret,t,e,r,n];return s!==a&&n.push(s),this.request("aria2.changeUri",n)},t.prototype.getOption=function(t){t=[this._secret,t];return this.request("aria2.getOption",t)},t.prototype.changeOption=function(t,e){e=[this._secret,t,e];return this.request("aria2.changeOption",e)},t.prototype.getGlobalOption=function(){var t=[this._secret];return this.request("aria2.getGlobalOption",t)},t.prototype.changeGlobalOption=function(t){t=[this._secret,t];return this.request("aria2.changeGlobalOption",t)},t.prototype.getGlobalStat=function(){var t=[this._secret];return this.request("aria2.getGlobalStat",t)},t.prototype.purgeDownloadResult=function(){var t=[this._secret];return this.request("aria2.purgeDownloadResult",t)},t.prototype.removeDownloadResult=function(t){t=[this._secret,t];return this.request("aria2.purgeDownloadResult",t)},t.prototype.getVersion=function(){var t=[this._secret];return this.request("aria2.getVersion",t)},t.prototype.getSessionInfo=function(){var t=[this._secret];return this.request("aria2.getSessionInfo",t)},t.prototype.saveSession=function(){var t=[this._secret];return this.request("aria2.saveSession",t)},t);function t(t,e){this.rpcPath=t,this._secret="token:"+e,this._jsonrpc=new r(t,function t(e){var r,n,s;for(s in e)"string"==(n=typeof(r=e[s]))?e[s]=function(t){var e=t.length;if(0<e&&e<=20){if((e=Number(t))||0===e)return e;if("true"===t)return!0;if("false"===t)return!1;if("null"===t)return null}return t}(r):"object"==n&&t(r);return e})}var h=function(t,o,u,a){return new(u=u||Promise)(function(r,e){function n(t){try{i(a.next(t))}catch(t){e(t)}}function s(t){try{i(a.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(n,s)}i((a=a.apply(t,o||[])).next())})},l=function(r,n){var s,i,o,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,i&&(o=2&e[0]?i.return:e[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,e[1])).done)return o;switch(i=0,(e=o?[2&e[0],o.value]:e)[0]){case 0:case 1:o=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,i=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(o=0<(o=u.trys).length&&o[o.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!o||e[1]>o[0]&&e[1]<o[3])){u.label=e[1];break}if(6===e[0]&&u.label<o[1]){u.label=o[1],o=e;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(e);break}o[2]&&u.ops.pop(),u.trys.pop();continue}e=n.call(r,u)}catch(t){e=[6,t],i=0}finally{s=o=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},p=new s("ws://localhost:6800/jsonrpc","arcticfox");!function(){h(this,void 0,void 0,function(){var e,r;return l(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,p.changeOption("0000000000000000",{"max-download-limit":"2M","max-upload-limit":"2M"})];case 1:return e=t.sent(),[3,3];case 2:return r=t.sent(),console.log("Error: ",r),[3,3];case 3:return p.onNotify("aria2.onDownloadStart",function(t){console.log("aria2.startDownload('"+t.gid+"');")}),p.onNotify("aria2.onBtDownloadComplete",function(r){return h(this,void 0,void 0,function(){var e;return l(this,function(t){switch(t.label){case 0:return console.log("aria2.btDownloadComplete('"+r.gid+"');"),[4,p.tellStatus(r.gid,["dir","files"])];case 1:return e=t.sent(),console.log("files: "+JSON.stringify(e.files)),e.files&&e.dir&&console.log("TitleName: "+s.getTitleName(e.files[0],e.dir)),[2]}})})}),console.log(e),[2]}})})}()});
